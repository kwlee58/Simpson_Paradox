---
title: "Student Crimtab Data for Simulation of T-Distribution"
author: "coop711"
date: "2015년 3월 25일"
output: html_document
---

Data Manipulation
-----------------

- Data Frame으로 정리하고, 다시 long format 으로 변환. height를 인치로 변환하면 어떻게 될까?

```{r}
dimnames(crimtab.2)[[2]]<-as.numeric(dimnames(crimtab.2)[[2]])/2.54
crimtab.2
crimtab.3<-crimtab.2
crimtab.3.df<-as.data.frame(crimtab.3, stringsAsFactors = F)
head(crimtab.3.df)
str(crimtab.3.df)
crimtab.3.df$finger<-as.numeric(crimtab.3.df$Var1)
crimtab.3.df$height<-as.numeric(crimtab.3.df$Var2)
str(crimtab.3.df)
crimtab.3.long<-apply(crimtab.3.df[,4:5], 2, function(x) rep(x, crimtab.3.df[,3]))
str(crimtab.3.long)
```


Student 의 Simulation 재현
---------------------------
 
 - 3,000장의 카드를 잘 섞는 것은 sample() 이용.
 
```{r}
crimtab.shuffle<-crimtab.3.long[sample(1:3000),]
```

- 표본의 크기가 4인 750개의 표본을 만드는 작업은 rep() 이용.

```{r}
crimtab.shuffle.sample.id<-as.factor(rep(1:750, each=4))
```

- 각 표본의 평균과 표준편차 계산에는 tapply() 이용. 

```{r}
crimtab.shuffle.sample.mean.finger<-tapply(crimtab.shuffle[,1], crimtab.shuffle.sample.id, mean)
crimtab.shuffle.sample.sd.finger<-tapply(crimtab.shuffle[,1], crimtab.shuffle.sample.id, sd)
```

- t-통계량 계산. Student는 표준편차 계산에서 분모에 $n$을 사용하고 히스토그램을 그려 비교하였으나 자유도 3인 t-분포와 비교하기 위하여 $t=\frac{\bar{X_n}-\mu}{SD/\sqrt{n}}$을 계산함.

```{r}
crimtab.shuffle.sample.t<-(crimtab.shuffle.sample.mean.finger-mean(crimtab.3.long[,1]))/(crimtab.shuffle.sample.sd.finger/sqrt(4))
```

- 계산한 t-통계량 값들의 평균과 표준편차, 히스토그램을 그리고 자유도 3인 t-분포의 밀도함수 및 표준정규곡선과 비교. 우선 모두 같은 값들이 나와서 분모가 0인 경우가 있는지 파악. 있으면 모평균과 비교하여 양수인 경우 +6, 음수인 경우 -6 값 부여(Student가 한 일)

```{r}
t.inf<-is.infinite(crimtab.shuffle.sample.t)
crimtab.shuffle.sample.t[t.inf]
crimtab.shuffle.sample.t[t.inf]<-6*sign(crimtab.shuffle.sample.t[t.inf])
```

- 문제되는 값이 없는 것을 확인하고, 평균과 표준편차 계산. 자유도 $n$인 t-분포의 평균과 표준편차은 각각 0과 $\sqrt{\frac{n}{n-2}}$임을 상기할 것.

```{r}
mean(crimtab.shuffle.sample.t)
sd(crimtab.shuffle.sample.t)
```

- t-통계량들의 히스토그램을 그리고, 자유도 3인 t의 밀도함수, 표준정규분포 밀도함수와 비교.

```{r}
hist(crimtab.shuffle.sample.t,prob=T,nclass=20,xlim=c(-6,6), ylim=c(0,0.5), main="Histogram of t-statistics", xlab="Sampled t-values")
lines(seq(-6,6,by=0.01), dt(seq(-6,6, by=0.01), df=3))
lines(seq(-6,6,by=0.01), dnorm(seq(-6,6, by=0.01)), col="red")
legend("topright", inset=0.05, lty=1, col=c("black","red"), legend=c("t with df=3", "standard normal"))
```

- qqnorm() 을 그려보면 정규분포와 꼬리에서 큰 차이가 난다는 것을 알 수 있음.

```{r}
qqnorm(crimtab.shuffle.sample.t)
```

